<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pablo's Pizza E2E Test Runner</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #FFC107, #FF9800);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            margin: 10px 0 0 0;
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .test-section {
            margin-bottom: 30px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }

        .test-section h3 {
            background: #f5f5f5;
            margin: 0;
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
            color: #555;
        }

        .test-content {
            padding: 20px;
        }

        .test-button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .test-button:active {
            transform: translateY(0);
        }

        .test-button.danger {
            background: linear-gradient(45deg, #f44336, #d32f2f);
        }

        .test-button.warning {
            background: linear-gradient(45deg, #ff9800, #f57c00);
        }

        .test-button.info {
            background: linear-gradient(45deg, #2196F3, #1976D2);
        }

        .results {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            min-height: 100px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            overflow-x: auto;
        }

        .results.success {
            border-left-color: #28a745;
            background: #d4edda;
        }

        .results.error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.loading {
            background: #ffc107;
            animation: pulse 1.5s ease-in-out infinite alternate;
        }

        .status-indicator.success {
            background: #28a745;
        }

        .status-indicator.error {
            background: #dc3545;
        }

        @keyframes pulse {
            from { opacity: 1; }
            to { opacity: 0.3; }
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            width: 0%;
            transition: width 0.3s ease;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 1px solid #e0e0e0;
        }

        .card h4 {
            margin-top: 0;
            color: #333;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .badge.success { background: #d4edda; color: #155724; }
        .badge.error { background: #f8d7da; color: #721c24; }
        .badge.warning { background: #fff3cd; color: #856404; }
        .badge.info { background: #d1ecf1; color: #0c5460; }

        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            border: 1px solid #e9ecef;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçï Pablo's Pizza E2E Tests</h1>
            <p>CORS and API Validation Test Suite</p>
        </div>

        <div class="content">
            <div class="test-section">
                <h3><span class="status-indicator" id="overall-status"></span>Test Execution Dashboard</h3>
                <div class="test-content">
                    <div class="progress-bar">
                        <div class="progress-bar-fill" id="progress-fill"></div>
                    </div>
                    <p>Current Status: <span id="current-status">Ready to start</span></p>

                    <button class="test-button" onclick="runAllTests()">üöÄ Run All Tests</button>
                    <button class="test-button info" onclick="runQuickCheck()">‚ö° Quick CORS Check</button>
                    <button class="test-button warning" onclick="clearResults()">üßπ Clear Results</button>
                    <button class="test-button danger" onclick="showConfiguration()">‚öôÔ∏è Configuration</button>
                </div>
            </div>

            <div class="test-section">
                <h3>Individual Test Controls</h3>
                <div class="test-content">
                    <button class="test-button" onclick="testHealthCheck()">üè• Health Check</button>
                    <button class="test-button" onclick="testContactForm()">üìß Contact Form</button>
                    <button class="test-button" onclick="testGalleryUpload()">üì∑ Gallery Upload</button>
                    <button class="test-button" onclick="testGalleryLoad()">üñºÔ∏è Gallery Load</button>
                    <button class="test-button" onclick="testCorsHeaders()">üîí CORS Headers</button>
                    <button class="test-button" onclick="testErrorHandling()">‚ùå Error Handling</button>
                </div>
            </div>

            <div class="grid">
                <div class="card">
                    <h4>üìä Test Results</h4>
                    <div id="test-summary">
                        <p>Total: <span id="total-tests">0</span></p>
                        <p>Passed: <span id="passed-tests">0</span></p>
                        <p>Failed: <span id="failed-tests">0</span></p>
                        <p>Success Rate: <span id="success-rate">0%</span></p>
                    </div>
                </div>

                <div class="card">
                    <h4>üîç Last Test Details</h4>
                    <div id="last-test-details">
                        <p>No tests run yet</p>
                    </div>
                </div>
            </div>

            <div class="results" id="results">
                Welcome to Pablo's Pizza E2E Test Runner!

                This tool tests the CORS and API fixes for:
                ‚úÖ Contact form chat room creation
                ‚úÖ Photo upload functionality
                ‚úÖ Gallery loading with event IDs
                ‚úÖ CORS headers on all endpoints
                ‚úÖ Error handling with proper CORS

                Click "Run All Tests" to start testing!
            </div>
        </div>
    </div>

    <script src="e2e-cors-api-tests.js"></script>
    <script>
        let testResults = {
            total: 0,
            passed: 0,
            failed: 0,
            tests: []
        };

        function updateStatus(status, type = 'info') {
            const statusEl = document.getElementById('current-status');
            const indicatorEl = document.getElementById('overall-status');

            statusEl.textContent = status;
            indicatorEl.className = 'status-indicator ' + type;
        }

        function updateProgress(percentage) {
            const progressEl = document.getElementById('progress-fill');
            progressEl.style.width = percentage + '%';
        }

        function updateSummary() {
            document.getElementById('total-tests').textContent = testResults.total;
            document.getElementById('passed-tests').textContent = testResults.passed;
            document.getElementById('failed-tests').textContent = testResults.failed;

            const successRate = testResults.total > 0 ?
                ((testResults.passed / testResults.total) * 100).toFixed(1) : 0;
            document.getElementById('success-rate').textContent = successRate + '%';
        }

        function logResult(testName, success, details = {}) {
            testResults.total++;
            if (success) {
                testResults.passed++;
            } else {
                testResults.failed++;
            }

            testResults.tests.push({
                name: testName,
                success,
                details,
                timestamp: new Date().toISOString()
            });

            const resultsEl = document.getElementById('results');
            const status = success ? '‚úÖ' : '‚ùå';
            const statusClass = success ? 'success' : 'error';

            resultsEl.innerHTML += `\n${status} ${testName}`;
            resultsEl.className = 'results ' + statusClass;
            resultsEl.scrollTop = resultsEl.scrollHeight;

            updateSummary();

            // Update last test details
            const lastTestEl = document.getElementById('last-test-details');
            lastTestEl.innerHTML = `
                <p><strong>${testName}</strong></p>
                <p><span class="badge ${success ? 'success' : 'error'}">${success ? 'PASSED' : 'FAILED'}</span></p>
                <p>Status: ${details.status || 'N/A'}</p>
                <p>Time: ${new Date().toLocaleTimeString()}</p>
            `;
        }

        async function runAllTests() {
            updateStatus('Running all tests...', 'loading');
            updateProgress(0);

            const resultsEl = document.getElementById('results');
            resultsEl.innerHTML = 'üéØ Starting comprehensive test suite...\n';
            resultsEl.className = 'results';

            testResults = { total: 0, passed: 0, failed: 0, tests: [] };

            try {
                const testSuite = new PablosPizzaE2ETests();
                const result = await testSuite.runAllTests();

                updateProgress(100);

                if (result.success) {
                    updateStatus('All tests passed!', 'success');
                } else {
                    updateStatus('Some tests failed', 'error');
                }

                testResults = result.summary;
                updateSummary();

            } catch (error) {
                updateStatus('Test suite failed', 'error');
                resultsEl.innerHTML += `\n‚ùå Error: ${error.message}`;
                resultsEl.className = 'results error';
            }
        }

        async function runQuickCheck() {
            updateStatus('Running quick CORS check...', 'loading');

            try {
                const result = await testCorsHeaders('/health');

                const resultsEl = document.getElementById('results');
                resultsEl.innerHTML = `Quick CORS Check Results:\n\n`;
                resultsEl.innerHTML += `Status: ${result.success ? '‚úÖ PASSED' : '‚ùå FAILED'}\n`;
                resultsEl.innerHTML += `Headers found:\n`;

                Object.entries(result.headers).forEach(([header, value]) => {
                    resultsEl.innerHTML += `  ${header}: ${value || 'MISSING'}\n`;
                });

                resultsEl.className = 'results ' + (result.success ? 'success' : 'error');
                updateStatus(result.success ? 'CORS check passed' : 'CORS check failed',
                           result.success ? 'success' : 'error');

            } catch (error) {
                updateStatus('Quick check failed', 'error');
                document.getElementById('results').innerHTML = `‚ùå Error: ${error.message}`;
            }
        }

        // Individual test functions
        async function testHealthCheck() {
            updateStatus('Testing health check...', 'loading');
            try {
                const testSuite = new PablosPizzaE2ETests();
                const result = await testSuite.testHealthCheck();
                logResult('Health Check', result);
                updateStatus('Health check completed', result ? 'success' : 'error');
            } catch (error) {
                logResult('Health Check', false, { error: error.message });
                updateStatus('Health check failed', 'error');
            }
        }

        async function testContactForm() {
            updateStatus('Testing contact form...', 'loading');
            try {
                const testSuite = new PablosPizzaE2ETests();
                const result = await testSuite.testContactFormChatCreation();
                logResult('Contact Form', result);
                updateStatus('Contact form test completed', result ? 'success' : 'error');
            } catch (error) {
                logResult('Contact Form', false, { error: error.message });
                updateStatus('Contact form test failed', 'error');
            }
        }

        async function testGalleryUpload() {
            updateStatus('Testing gallery upload...', 'loading');
            try {
                const testSuite = new PablosPizzaE2ETests();
                const result = await testSuite.testGalleryPhotoUpload();
                logResult('Gallery Upload', result);
                updateStatus('Gallery upload test completed', result ? 'success' : 'error');
            } catch (error) {
                logResult('Gallery Upload', false, { error: error.message });
                updateStatus('Gallery upload test failed', 'error');
            }
        }

        async function testGalleryLoad() {
            updateStatus('Testing gallery loading...', 'loading');
            try {
                const testSuite = new PablosPizzaE2ETests();
                const result = await testSuite.testGalleryLoadingWithEventId();
                logResult('Gallery Loading', result);
                updateStatus('Gallery loading test completed', result ? 'success' : 'error');
            } catch (error) {
                logResult('Gallery Loading', false, { error: error.message });
                updateStatus('Gallery loading test failed', 'error');
            }
        }

        async function testCorsHeaders() {
            updateStatus('Testing CORS headers...', 'loading');
            try {
                const testSuite = new PablosPizzaE2ETests();
                const result = await testSuite.testCorsOrigins();
                logResult('CORS Headers', result);
                updateStatus('CORS headers test completed', result ? 'success' : 'error');
            } catch (error) {
                logResult('CORS Headers', false, { error: error.message });
                updateStatus('CORS headers test failed', 'error');
            }
        }

        async function testErrorHandling() {
            updateStatus('Testing error handling...', 'loading');
            try {
                const testSuite = new PablosPizzaE2ETests();
                const result = await testSuite.testErrorHandling();
                logResult('Error Handling', result);
                updateStatus('Error handling test completed', result ? 'success' : 'error');
            } catch (error) {
                logResult('Error Handling', false, { error: error.message });
                updateStatus('Error handling test failed', 'error');
            }
        }

        function clearResults() {
            document.getElementById('results').innerHTML = 'Results cleared. Ready for new tests.';
            document.getElementById('results').className = 'results';
            testResults = { total: 0, passed: 0, failed: 0, tests: [] };
            updateSummary();
            updateStatus('Ready to start', 'info');
            updateProgress(0);
        }

        function showConfiguration() {
            const config = {
                'API Base URL': TEST_CONFIG.BASE_URL,
                'Frontend URL': TEST_CONFIG.FRONTEND_URL,
                'Contact URL': TEST_CONFIG.CONTACT_URL,
                'Admin URL': TEST_CONFIG.ADMIN_URL,
                'Timeout': TEST_CONFIG.TIMEOUT + 'ms'
            };

            const resultsEl = document.getElementById('results');
            resultsEl.innerHTML = 'Current Configuration:\n\n';

            Object.entries(config).forEach(([key, value]) => {
                resultsEl.innerHTML += `${key}: ${value}\n`;
            });

            resultsEl.innerHTML += '\nExpected CORS Headers:\n';
            TEST_CONFIG.EXPECTED_CORS_HEADERS.forEach(header => {
                resultsEl.innerHTML += `  - ${header}\n`;
            });

            resultsEl.className = 'results info';
        }

        // Initialize
        updateStatus('Ready to start', 'info');
        updateSummary();

        console.log('üéØ Pablo\'s Pizza E2E Test Runner Loaded');
        console.log('Available functions:');
        console.log('- runAllTests()');
        console.log('- runQuickCheck()');
        console.log('- Individual test functions available via buttons');
    </script>
</body>
</html>